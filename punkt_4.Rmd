---
title: "4. Pendling mellom de ulike kommunene i regionen."
subtitle: "MSB 106 - Anvendt By- og Regionaløkonomi"
output: html_notebook
---

```{r setup}
suppressPackageStartupMessages({
library(tidyverse)
library(lubridate)
library(PxWebApiData)
library(readr)
library(ggplot2)
})
#knitr::opts_chunk$set(eval=FALSE)
```


# Tabell for år 2000

```{r}
Tab_03321_00 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151, 
                           1154, 1159, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1154, 1159, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2000"
  )
```

```{r}
names(Tab_03321_00)[[1]] <- "desc"
```

```{r}
Tab_03321_00 <- Tab_03321_00$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_00$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_00$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_00 <- Tab_03321_00 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_00$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2001

```{r}
Tab_03321_01 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151, 
                           1154, 1159, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1154, 1159, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2001"
  )
```

```{r}
names(Tab_03321_01)[[1]] <- "desc"
```

```{r}
Tab_03321_01 <- Tab_03321_01$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_01$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_01$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_01 <- Tab_03321_01 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_01$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2002

```{r}
Tab_03321_02 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151, 
                           1154, 1159, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1154, 1159, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2002"
  )
```

```{r}
names(Tab_03321_02)[[1]] <- "desc"
```

```{r}
Tab_03321_02 <- Tab_03321_02$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_02$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_02$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_02 <- Tab_03321_02 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_02$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2003

```{r}
Tab_03321_03 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151, 
                           1154, 1159, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1154, 1159, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2003"
  )
```

```{r}
names(Tab_03321_03)[[1]] <- "desc"
```

```{r}
Tab_03321_03 <- Tab_03321_03$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_03$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_03$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_03 <- Tab_03321_03 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_03$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2004

```{r}
Tab_03321_04 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151, 
                           1154, 1159, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1154, 1159, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2004"
  )
```

```{r}
names(Tab_03321_04)[[1]] <- "desc"
```

```{r}
Tab_03321_04 <- Tab_03321_04$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_04$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_04$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_04 <- Tab_03321_04 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_04$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2005

```{r}
Tab_03321_05 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2005"
  )
```

```{r}
names(Tab_03321_05)[[1]] <- "desc"
```

```{r}
Tab_03321_05 <- Tab_03321_05$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_05$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_05$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_05 <- Tab_03321_05 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_05$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2006

```{r}
Tab_03321_06 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2006"
  )
```

```{r}
names(Tab_03321_06)[[1]] <- "desc"
```

```{r}
Tab_03321_06 <- Tab_03321_06$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_06$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_06$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_06 <- Tab_03321_06 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_06$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2007

```{r}
Tab_03321_07 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2007"
  )
```

```{r}
names(Tab_03321_07)[[1]] <- "desc"
```

```{r}
Tab_03321_07 <- Tab_03321_07$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_07$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_07$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_07 <- Tab_03321_07 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_07$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2008

```{r}
Tab_03321_08 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2008"
  )
```

```{r}
names(Tab_03321_08)[[1]] <- "desc"
```

```{r}
Tab_03321_08 <- Tab_03321_08$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_08$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_08$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_08 <- Tab_03321_08 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_08$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2009

```{r}
Tab_03321_09 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2009"
  )
```

```{r}
names(Tab_03321_09)[[1]] <- "desc"
```

```{r}
Tab_03321_09 <- Tab_03321_09$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_09$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_09$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_09 <- Tab_03321_09 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_09$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2010

```{r}
Tab_03321_10 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2010"
  )
```

```{r}
names(Tab_03321_10)[[1]] <- "desc"
```

```{r}
Tab_03321_10 <- Tab_03321_10$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_10$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_10$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_10 <- Tab_03321_10 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_10$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2011

```{r}
Tab_03321_11 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2011"
  )
```

```{r}
names(Tab_03321_11)[[1]] <- "desc"
```

```{r}
Tab_03321_11 <- Tab_03321_11$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_11$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_11$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_11 <- Tab_03321_11 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_11$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2012

```{r}
Tab_03321_12 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2012"
  )
```

```{r}
names(Tab_03321_12)[[1]] <- "desc"
```

```{r}
Tab_03321_12 <- Tab_03321_12$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_12$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_12$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_12 <- Tab_03321_12 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_12$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2013

```{r}
Tab_03321_13 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2013"
  )
```

```{r}
names(Tab_03321_13)[[1]] <- "desc"
```

```{r}
Tab_03321_13 <- Tab_03321_13$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_13$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_13$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_13 <- Tab_03321_13 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_13$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2014

```{r}
Tab_03321_14 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2014"
  )
```

```{r}
names(Tab_03321_14)[[1]] <- "desc"
```

```{r}
Tab_03321_14 <- Tab_03321_14$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_14$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_14$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_14 <- Tab_03321_14 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_14$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2015

```{r}
Tab_03321_15 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2015"
  )
```

```{r}
names(Tab_03321_15)[[1]] <- "desc"
```

```{r}
Tab_03321_15 <- Tab_03321_15$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_15$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_15$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_15 <- Tab_03321_15 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_15$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2016

```{r}
Tab_03321_16 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2016"
  )
```

```{r}
names(Tab_03321_16)[[1]] <- "desc"
```

```{r}
Tab_03321_16 <- Tab_03321_16$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_16$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_16$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_16 <- Tab_03321_16 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_16$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2017

```{r}
Tab_03321_17 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2017"
  )
```

```{r}
names(Tab_03321_17)[[1]] <- "desc"
```

```{r}
Tab_03321_17 <- Tab_03321_17$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_17$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_17$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_17 <- Tab_03321_17 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_17$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2018

```{r}
Tab_03321_18 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2018"
  )
```

```{r}
names(Tab_03321_18)[[1]] <- "desc"
```

```{r}
Tab_03321_18 <- Tab_03321_18$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_18$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_18$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_18 <- Tab_03321_18 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_18$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2019

```{r}
Tab_03321_19 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1160, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231),
                       ""
                       )
                ),
  Tid = "2019"
  )
```

```{r}
names(Tab_03321_19)[[1]] <- "desc"
```

```{r}
Tab_03321_19 <- Tab_03321_19$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_19$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_19$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_19 <- Tab_03321_19 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_19$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# Tabell for år 2020

```{r}
Tab_03321_20 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160,
                           4611, 4612, 
                           4613, 4614, 
                           4615, 4616, 
                           4617, 4618),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151,
                           1160,
                           4611, 4612, 
                           4613, 4614, 
                           4615, 4616, 
                           4617, 4618),
                       ""
                       )
                ),
  Tid = "2020"
  )
```

```{r}
names(Tab_03321_20)[[1]] <- "desc"
```

```{r}
Tab_03321_20 <- Tab_03321_20$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_03321_20$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_03321_20$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_03321_20 <- Tab_03321_20 %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_03321_20$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```




# Sammenslåing av tabellene

```{r}
Tab_0321_00_04 <- rbind(Tab_03321_00, Tab_03321_01, Tab_03321_02, Tab_03321_03, Tab_03321_04)
```

```{r}
Tab_0321_05_19 <- rbind(Tab_03321_05, Tab_03321_06, Tab_03321_06, Tab_03321_07, Tab_03321_08, Tab_03321_09, Tab_03321_10, Tab_03321_11, Tab_03321_12, Tab_03321_13, Tab_03321_14, Tab_03321_15, Tab_03321_16, Tab_03321_17, Tab_03321_18, Tab_03321_19)
```


# Tabell 0321 for alle år - Atlerantiv måte for ggplot? (Trenger hjelp med dette Arnstein)

```{r}
Tab_Test_Alle_Aar <- ApiData(
  urlToData = "03321",
  ArbstedKomm = c(paste0(c(1106, 1135, 
                           1145, 1146, 
                           1149, 1151, 
                           1154, 1159, 
                           1211, 1216, 
                           1219, 1221, 
                           1222, 1223, 
                           1224, 1228, 
                           1231, 1160,
                           4611, 4612, 
                           4613, 4614, 
                           4615, 4616, 
                           4617, 4618),
                         ""
                         )
                  ), 
  ContentsCode = "Sysselsatte",
  Bokommuen = c(paste0(c(1106, 1135, 
                         1145, 1146, 
                         1149, 1151, 
                         1154, 1159, 
                         1211, 1216, 
                         1219, 1221, 
                         1222, 1223, 
                         1224, 1228, 
                         1231, 1160,
                         4611, 4612, 
                         4613, 4614,
                         4615, 4616, 
                         4617, 4618),
                       ""
                       )
                ),
  Tid = c(as.character(2000:2020))
  )
```


```{r}
names(Tab_Test_Alle_Aar)[[1]] <- "desc"
```


```{r}
Tab_Test_Alle_Aar <- Tab_Test_Alle_Aar$dataset %>% 
  mutate(
    NavnArbstedKomm = Tab_Test_Alle_Aar$desc$arbeidsstedskommune,
    NavnBokommuen = Tab_Test_Alle_Aar$desc$bostedskommune
  ) %>% 
  unite("ArbstedKomm", NavnArbstedKomm, ArbstedKomm) %>% 
  unite("Bokommuen", NavnBokommuen, Bokommuen) %>% 
  select(-ContentsCode, -Tid) %>% 
  pivot_wider(
    id_cols = Bokommuen,
    names_from = ArbstedKomm,
    values_from = value
  )
```

```{r}
Tab_Test_Alle_Aar <- Tab_Test_Alle_Aar %>% 
  rename(Bokommune = Bokommuen) %>% 
  select(-Bokommune) %>%
  mutate(
         Tot_bosted = rowSums(.),
         Pendlere = Tot_bosted - diag(as.matrix(.)),
         Andel_pendlere = round(Pendlere/Tot_bosted*100, 2),
         Tot_arb_komm = colSums(.),
         Arb_inv = Tot_arb_komm - diag(as.matrix(.)),
         Andel_arb_inv = round(Arb_inv/Tot_arb_komm*100, 2),
         Bo_og_arb_komm = Tot_bosted - Pendlere,
         Andel_bo_arb_komm = round(Bo_og_arb_komm/Tot_bosted*100, 2),
         Bokommune = Tab_Test_Alle_Aar$Bokommuen
                    ) %>% 
  select(Bokommune, everything())
```


# 2000 til 2020 fra ag

```{r}
# Antar at de nye også skal med
# 1214 Ølen fra 2000 til 2002 skal vel også med
# Ser ikke ut til at denne eksisterer i statistikken
# Medfører at det blir et brudd for Vindafjord 2003 tror jeg
# Har ikke justert for delen av Ullensvang som gikk til Voss 2020
# 1160 Vindafjord må med
knr <- c("1106", "1135", "1145", "1146", "1149", "1151", "1154", "1159", "1160", "1211", 
         "1216", "1219", "1221", "1222", "1223", "1224", "1228", "1231", "4611", "4612", 
         "4613", "4614", "4615", "4616", "4617", "4618")
```


```{r}
Tab_03321_00_20 <- ApiData(
  urlToData = "03321",
  ArbstedKomm = knr, 
  ContentsCode = "Sysselsatte",
  Bokommuen = knr,
  Tid = as.character(2000:2020)
  )
```

```{r}
names(Tab_03321_00_20)[1] <- "desc"
```


```{r}
Tab_03321_00_20 <- Tab_03321_00_20 %>% 
  # combine to one list
  unlist(recursive = FALSE) %>% 
  # make a tibble of the list
  as_tibble() %>% 
  # rename variables
  transmute(
    a_knavn = desc.arbeidsstedskommune,
    a_knr = dataset.ArbstedKomm,
    b_knavn = desc.bostedskommune,
    b_knr = dataset.Bokommuen,
    aar = desc.år,
    personer = desc.value
  ) %>% 
  mutate(
    a_knr_new = case_when(
      a_knr == "1219" ~ "4613",
      a_knr == "1211" ~ "4611",
      a_knr == "1222" ~ "4615",
      a_knr == "1224" ~ "4617",
      a_knr %in% c("1227", "1228", "1231") ~ "4618",
      a_knr == "1221" ~ "4614",
      a_knr == "1216" ~ "4612",
      a_knr == "1223" ~  "4616",
      a_knr %in% c("1154", "1159", "1214") ~ "1160",
      # all others same as a_knr
      TRUE ~ a_knr
    ),
    b_knr_new = case_when(
      b_knr == "1219" ~ "4613",
      b_knr == "1211" ~ "4611",
      b_knr == "1222" ~ "4615",
      b_knr == "1224" ~ "4617",
      b_knr %in% c("1227", "1228", "1231") ~ "4618",
      b_knr == "1221" ~ "4614",
      b_knr == "1216" ~ "4612",
      b_knr == "1223" ~  "4616",
      b_knr %in% c("1154", "1159", "1214") ~ "1160",
      # all others same as a_knr
      TRUE ~ b_knr
      ),
    a_knavn_new = case_when(
      a_knr %in% c("1154", "1159", "1214") ~ "Vindafjord",
      a_knr %in% c("1227", "1228", "1231") ~ "Ullensvang",
      a_knr == "1219" ~ "Bømlo",
      a_knr == "1211" ~ "Etne",
      a_knr == "1222" ~ "Fitjar",
      a_knr == "1224" ~ "Kvinnherad",
      a_knr == "1221" ~ "Stord",
      a_knr == "1216" ~ "Sveio",
      a_knr == "1223" ~ "Tysnes",
      TRUE ~ a_knavn
    ),
    b_knavn_new = case_when(
      b_knr %in% c("1154", "1159", "1214") ~ "Vindafjord",
      b_knr %in% c("1227", "1228", "1231") ~ "Ullensvang",
      b_knr == "1219" ~ "Bømlo",
      b_knr == "1211" ~ "Etne",
      b_knr == "1222" ~ "Fitjar",
      b_knr == "1224" ~ "Kvinnherad",
      b_knr == "1221" ~ "Stord",
      b_knr == "1216" ~ "Sveio",
      b_knr == "1223" ~ "Tysnes",    
      TRUE ~ b_knavn
  )
  )
```

```{r}
# Personer som arbeider, konvertert til 2020 kommuner
Tab_03321_00_20_a <- Tab_03321_00_20 %>%
  group_by(a_knr_new, b_knr_new, a_knavn_new, b_knavn_new, aar) %>% 
  summarise(personer_new = sum(personer)) %>% 
  select(aar, a_knr_new, a_knavn_new, b_knr_new, b_knavn_new, personer_new)
```

```{r}
# pendlematrise år 2000 oppdatert til kommunestruktur 2020
# bor vertikalt, arbeider horisontalt
tab_2000 <- Tab_03321_00_20_a %>% 
  filter(aar == "2000") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2001 <- Tab_03321_00_20_a %>% 
  filter(aar == "2001") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2002 <- Tab_03321_00_20_a %>% 
  filter(aar == "2002") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2003 <- Tab_03321_00_20_a %>% 
  filter(aar == "2003") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2004 <- Tab_03321_00_20_a %>% 
  filter(aar == "2004") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2005 <- Tab_03321_00_20_a %>% 
  filter(aar == "2005") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2006 <- Tab_03321_00_20_a %>% 
  filter(aar == "2006") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2007 <- Tab_03321_00_20_a %>% 
  filter(aar == "2007") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2008 <- Tab_03321_00_20_a %>% 
  filter(aar == "2008") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2009 <- Tab_03321_00_20_a %>% 
  filter(aar == "2009") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2010 <- Tab_03321_00_20_a %>% 
  filter(aar == "2010") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2011 <- Tab_03321_00_20_a %>% 
  filter(aar == "2011") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2012 <- Tab_03321_00_20_a %>% 
  filter(aar == "2012") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2013 <- Tab_03321_00_20_a %>% 
  filter(aar == "2013") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2014 <- Tab_03321_00_20_a %>% 
  filter(aar == "2014") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2015 <- Tab_03321_00_20_a %>% 
  filter(aar == "2015") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2016 <- Tab_03321_00_20_a %>% 
  filter(aar == "2016") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2017 <- Tab_03321_00_20_a %>% 
  filter(aar == "2017") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2018 <- Tab_03321_00_20_a %>% 
  filter(aar == "2018") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```

```{r}
tab_2019 <- Tab_03321_00_20_a %>% 
  filter(aar == "2019") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```


osv. for de andre årene

```{r}
# pendlematrise år 2020 oppdatert til kommunestruktur 2020
# bor vertikalt, arbeider horisontalt
tab_2020 <- Tab_03321_00_20_a %>% 
  filter(aar == "2020") %>% 
  select(-aar) %>% 
  pivot_wider(
    names_from = c("a_knavn_new", "a_knr_new"),
    values_from = personer_new
  )
```




```{r}
Tab_03321_00_20_a %>% 
  # bor i Haugesund, jobber annet sted enn Haugesund, Tysvær, Karmøy
  filter(b_knr_new == "1106" & !a_knr_new %in% c("1106", "1146", "1149")) %>% 
  ggplot(mapping = aes(x = as_date(paste0(aar, "-01-01")))) +
  geom_line(mapping=aes(y = personer_new, group = a_knavn_new, colour = a_knavn_new)) +
  xlab("År") +
  ylab("Antall personer") +
  labs(colour = "Kommune")
```


